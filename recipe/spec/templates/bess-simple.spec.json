{
  "_comment": "Simple 100 MW BESS Model - Formula-based (no iterative solvers)",
  "_instructions": "This spec uses simple formulas for debt, no complex modules needed",

  "project": {
    "name": "100 MW / 200 MWh BESS (Simple)",
    "type": "BESS",
    "currency": "AUD",
    "financialYearEnd": 6
  },

  "timeline": {
    "start": "Apr 2027",
    "end": "Mar 2057"
  },

  "keyPeriods": [
    {
      "name": "Construction",
      "flag": "F1",
      "duration": "18 months",
      "start": "timeline.start"
    },
    {
      "name": "Operations",
      "flag": "F2",
      "duration": "300 months",
      "start": "after F1"
    },
    {
      "name": "Tolling",
      "flag": "F6",
      "duration": "120 months",
      "start": "after F1"
    },
    {
      "name": "Merchant",
      "flag": "F7",
      "duration": "180 months",
      "start": "after F6"
    },
    {
      "name": "Debt",
      "flag": "F8",
      "duration": "180 months",
      "start": "after F1"
    }
  ],

  "indices": [
    { "id": 2, "name": "CPI", "rate": 2.5, "startYear": 2026 }
  ],

  "constants": [
    { "name": "PowerMW", "value": 100 },
    { "name": "EnergyMWh", "value": 200 },
    { "name": "TollingFee", "value": 85, "_comment": "$/kW/yr" },
    { "name": "FCASRate", "value": 25000, "_comment": "$/MW/yr" },
    { "name": "ArbRate", "value": 35000, "_comment": "$/MW/yr" },
    { "name": "OMRate", "value": 8, "_comment": "$/kW/yr" },
    { "name": "InsurancePct", "value": 0.5 },
    { "name": "LandLease", "value": 100, "_comment": "$k/yr" },
    { "name": "Availability", "value": 97 },
    { "name": "Degradation", "value": 2.5, "_comment": "%/yr" },
    { "name": "DebtGearing", "value": 70 },
    { "name": "DebtRate", "value": 7.5 },
    { "name": "TaxRate", "value": 30 },
    { "name": "AssetLife", "value": 25 }
  ],

  "inputGroups": [
    { "id": 1, "name": "CAPEX", "mode": "values", "frequency": "M", "linkedPeriod": "F1" },
    { "id": 2, "name": "OPEX", "mode": "series", "frequency": "M", "linkedPeriod": "F2" }
  ],

  "inputs": [
    { "id": 1, "name": "BatteryCapex", "group": "CAPEX", "value": 70 },
    { "id": 2, "name": "BOPCapex", "group": "CAPEX", "value": 15 },
    { "id": 3, "name": "GridCapex", "group": "CAPEX", "value": 8 },
    { "id": 4, "name": "DevCapex", "group": "CAPEX", "value": 5 },
    { "id": 10, "name": "OMCosts", "group": "OPEX", "value": 0.8 },
    { "id": 11, "name": "LandCosts", "group": "OPEX", "value": 0.1 }
  ],

  "calculationGroups": [
    { "id": 1, "name": "Performance", "tab": "Revenue" },
    { "id": 2, "name": "Revenue", "tab": "Revenue" },
    { "id": 3, "name": "Costs", "tab": "P&L" },
    { "id": 4, "name": "EBITDA", "tab": "P&L" },
    { "id": 5, "name": "DA", "tab": "P&L" },
    { "id": 6, "name": "Debt", "tab": "P&L" },
    { "id": 7, "name": "Tax", "tab": "P&L" },
    { "id": 8, "name": "NetIncome", "tab": "P&L" },
    { "id": 10, "name": "CashFlow", "tab": "Cash Flow" },
    { "id": 20, "name": "Assets", "tab": "Balance Sheet" },
    { "id": 21, "name": "Liabilities", "tab": "Balance Sheet" },
    { "id": 22, "name": "Equity", "tab": "Balance Sheet" },
    { "id": 30, "name": "Returns", "tab": "Returns" }
  ],

  "calculations": [
    {
      "_comment": "=== PERFORMANCE ===",
      "id": 1,
      "name": "EffectiveCapacity",
      "formula": "{PowerMW} * {Availability} / 100 * MAX(0, 1 - {Degradation} / 100 * CUMSUM(F2) / T.MiY) * F2",
      "group": "Performance",
      "type": "flow"
    },

    {
      "_comment": "=== REVENUE ===",
      "id": 4,
      "name": "TollingRevenue",
      "formula": "{PowerMW} * {TollingFee} / T.MiY / 10^6 * F6 * I2",
      "group": "Revenue",
      "type": "flow"
    },
    {
      "id": 5,
      "name": "FCASRevenue",
      "formula": "R1 * {FCASRate} / T.MiY / 10^6 * F7",
      "group": "Revenue",
      "type": "flow"
    },
    {
      "id": 6,
      "name": "ArbRevenue",
      "formula": "R1 * {ArbRate} / T.MiY / 10^6 * F7",
      "group": "Revenue",
      "type": "flow"
    },
    {
      "id": 10,
      "name": "TotalRevenue",
      "formula": "R4 + R5 + R6",
      "group": "Revenue",
      "type": "flow"
    },

    {
      "_comment": "=== COSTS ===",
      "id": 11,
      "name": "OMExpense",
      "formula": "-{OMCosts} / T.MiY * F2 * I2",
      "group": "Costs",
      "type": "flow"
    },
    {
      "id": 12,
      "name": "Insurance",
      "formula": "-CUMSUM({BatteryCapex} + {BOPCapex} + {GridCapex} + {DevCapex}) * {InsurancePct} / 100 / T.MiY * F2",
      "group": "Costs",
      "type": "flow"
    },
    {
      "id": 13,
      "name": "LandExpense",
      "formula": "-{LandCosts} / T.MiY * F2 * I2",
      "group": "Costs",
      "type": "flow"
    },
    {
      "id": 15,
      "name": "TotalOPEX",
      "formula": "R11 + R12 + R13",
      "group": "Costs",
      "type": "flow"
    },

    {
      "_comment": "=== EBITDA ===",
      "id": 20,
      "name": "EBITDA",
      "formula": "R10 + R15",
      "group": "EBITDA",
      "type": "flow"
    },

    {
      "_comment": "=== DEPRECIATION (CUMSUM Ledger) ===",
      "id": 81,
      "name": "DAAddition",
      "formula": "CUMSUM({BatteryCapex} + {BOPCapex} + {GridCapex} + {DevCapex}) * F2.Start",
      "group": "DA",
      "type": "flow"
    },
    {
      "id": 82,
      "name": "DACharge",
      "formula": "-MIN(CUMSUM(R81), CUMSUM({BatteryCapex} + {BOPCapex} + {GridCapex} + {DevCapex}) / {AssetLife} / T.MiY) * F2",
      "group": "DA",
      "type": "flow"
    },
    {
      "id": 84,
      "name": "DAClosing",
      "formula": "MAX(0, CUMSUM(R81) + CUMSUM(R82))",
      "group": "DA",
      "type": "stock"
    },
    {
      "id": 21,
      "name": "EBIT",
      "formula": "R20 + R82",
      "group": "DA",
      "type": "flow"
    },

    {
      "_comment": "=== DEBT (Simple Formula) ===",
      "id": 90,
      "name": "TotalCapex",
      "formula": "CUMSUM({BatteryCapex} + {BOPCapex} + {GridCapex} + {DevCapex})",
      "group": "Debt",
      "type": "stock"
    },
    {
      "id": 91,
      "name": "DebtPrincipal",
      "formula": "R90 * {DebtGearing} / 100",
      "group": "Debt",
      "type": "stock",
      "_comment": "70% gearing on total CAPEX"
    },
    {
      "id": 92,
      "name": "DebtDrawdown",
      "formula": "R91 * F2.Start",
      "group": "Debt",
      "type": "flow",
      "_comment": "Drawdown at COD"
    },
    {
      "id": 93,
      "name": "DebtRepayment",
      "formula": "-R91 / F8.M * F8",
      "group": "Debt",
      "type": "flow",
      "_comment": "Straight-line repayment over debt tenor"
    },
    {
      "id": 94,
      "name": "DebtClosing",
      "formula": "MAX(0, CUMSUM(R92) + CUMSUM(R93))",
      "group": "Debt",
      "type": "stock"
    },
    {
      "id": 95,
      "name": "InterestExpense",
      "formula": "-R94 * {DebtRate} / 100 / T.MiY",
      "group": "Debt",
      "type": "flow",
      "_comment": "Interest on closing balance"
    },

    {
      "_comment": "=== TAX & NET INCOME ===",
      "id": 17,
      "name": "EBT",
      "formula": "R21 + R95",
      "group": "Tax",
      "type": "flow"
    },
    {
      "id": 18,
      "name": "TaxExpense",
      "formula": "-MAX(0, R17) * {TaxRate} / 100",
      "group": "Tax",
      "type": "flow"
    },
    {
      "id": 19,
      "name": "NPAT",
      "formula": "R17 + R18",
      "group": "NetIncome",
      "type": "flow"
    },

    {
      "_comment": "=== CASH FLOW ===",
      "id": 40,
      "name": "OperatingCF",
      "formula": "R19 - R82",
      "group": "CashFlow",
      "type": "flow"
    },
    {
      "id": 41,
      "name": "CapexCF",
      "formula": "-({BatteryCapex} + {BOPCapex} + {GridCapex} + {DevCapex}) * F1",
      "group": "CashFlow",
      "type": "flow"
    },
    {
      "id": 50,
      "name": "DebtDrawdownCF",
      "formula": "R92",
      "group": "CashFlow",
      "type": "flow"
    },
    {
      "id": 51,
      "name": "DebtRepaymentCF",
      "formula": "R93",
      "group": "CashFlow",
      "type": "flow"
    },
    {
      "id": 52,
      "name": "EquityInjection",
      "formula": "R41 - R50",
      "group": "CashFlow",
      "type": "flow"
    },
    {
      "id": 53,
      "name": "Dividends",
      "formula": "-MAX(0, R40 + R95 + R51) * F2",
      "group": "CashFlow",
      "type": "flow"
    },
    {
      "id": 60,
      "name": "NetCashFlow",
      "formula": "R40 + R41 + R50 + R51 + R52 + R53",
      "group": "CashFlow",
      "type": "flow"
    },
    {
      "id": 61,
      "name": "CashBalance",
      "formula": "CUMSUM(R60)",
      "group": "CashFlow",
      "type": "stock"
    },

    {
      "_comment": "=== BALANCE SHEET ===",
      "id": 182,
      "name": "Cash",
      "formula": "R61",
      "group": "Assets",
      "type": "stock"
    },
    {
      "id": 183,
      "name": "PPE",
      "formula": "R84",
      "group": "Assets",
      "type": "stock"
    },
    {
      "id": 185,
      "name": "TotalAssets",
      "formula": "R182 + R183",
      "group": "Assets",
      "type": "stock"
    },
    {
      "id": 190,
      "name": "DebtOutstanding",
      "formula": "R94",
      "group": "Liabilities",
      "type": "stock"
    },
    {
      "id": 191,
      "name": "TotalLiabilities",
      "formula": "R190",
      "group": "Liabilities",
      "type": "stock"
    },
    {
      "id": 192,
      "name": "ShareCapital",
      "formula": "CUMSUM(R52)",
      "group": "Equity",
      "type": "stock"
    },
    {
      "id": 193,
      "name": "RetainedEarnings",
      "formula": "CUMSUM(R19 + R53)",
      "group": "Equity",
      "type": "stock"
    },
    {
      "id": 194,
      "name": "TotalEquity",
      "formula": "R192 + R193",
      "group": "Equity",
      "type": "stock"
    },
    {
      "id": 195,
      "name": "BalanceCheck",
      "formula": "R185 - R191 - R194",
      "group": "Equity",
      "type": "stock"
    },

    {
      "_comment": "=== RETURNS ===",
      "id": 125,
      "name": "EquityCashFlows",
      "formula": "R52 + R53",
      "group": "Returns",
      "type": "flow"
    },
    {
      "id": 118,
      "name": "DSCR",
      "formula": "IF(-R93 > 0, (R40 + R95) / (-R93 - R95), 0)",
      "group": "Returns",
      "type": "ratio"
    }
  ],

  "modules": [],

  "validation": {
    "balanceSheetTolerance": 0.01
  }
}
